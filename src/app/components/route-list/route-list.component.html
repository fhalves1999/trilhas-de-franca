<div class="route-list-container">
  <app-search-routes (search)="onSearch($event)"></app-search-routes>

<div class="sort-container" [style]="{textAlign: 'center', 'width': '100%'}">
  <mat-form-field appearance="outline" class="sort-field" [style]="{textAlign: 'center', 'width': '100%'}">
    <mat-label>Ordenar por</mat-label>
    <mat-select [(value)]="sortBy" (selectionChange)="onSortChange()">
      <mat-option value="name">Nome</mat-option>
      <mat-option value="elevation">Elevação</mat-option>
      <mat-option value="distance">Distância</mat-option>
      <mat-option value="duration">Tempo de duração</mat-option>
      <mat-option value="nivel">Nível de dificuldade</mat-option>
    </mat-select>
  </mat-form-field>
  <mat-form-field appearance="outline" class="sort-direction-field" [style]="{textAlign: 'center', 'width': '100%'}">
    <mat-label>Direção</mat-label>
    <mat-select [(value)]="sortDirection" (selectionChange)="onSortChange()">
      <mat-option value="desc">Maior para menor</mat-option>
      <mat-option value="asc">Menor para maior</mat-option>
    </mat-select>
  </mat-form-field>
</div>

  <div *ngIf="loading" class="loading">
    <mat-spinner diameter="40"></mat-spinner>
    <span>Carregando rotas...</span>
  </div>

  <ng-container *ngIf="!loading">
    <div *ngIf="paginatedRoutes && paginatedRoutes.length > 0">
      <div class="route-row" *ngFor="let route of paginatedRoutes">
        <div class="route-info">
          <div class="route-title">
            <mat-icon color="accent" class="bike-icon">directions_bike</mat-icon>
            <span>{{ route.name }}</span>
          </div>
          <div class="route-details">
            <span><strong>Distância:</strong> {{ route.distance / 1000 | number:'1.2-2' }} km</span>
          </div>
          <div class="route-details">
            <span><strong>Elevação:</strong> {{ route.elevation_gain | number:'1.0-0' }} m</span>
          </div>
          <div class="route-time">
            <span><strong>Tempo estimado:</strong> {{ route.estimated_moving_time | timeFormat }}</span>
          </div>

          <div class="route-details">
            <span>
              <strong>Nível de dificuldade: </strong>
              <span [ngClass]="getDificuldadeClass(route)">
                {{ getDificuldadeLabel(route) }}
              </span>
            </span>
          </div>         
        </div>

        <!-- Botão de download -->
        <div class="download-btn-container">
          <button
            mat-raised-button
            color="primary"
            [disabled]="isDownloadingGpx === route.id_str"
            (click)="downloadGpx(route.id_str)"
          >
            <mat-icon *ngIf="isDownloadingGpx !== route.id_str">download</mat-icon>
            <mat-spinner *ngIf="isDownloadingGpx === route.id_str" diameter="24" style="margin-right:8px"></mat-spinner>
            <span *ngIf="isDownloadingGpx !== route.id_str">Baixar arquivo .GPX da rota</span>
            <span *ngIf="isDownloadingGpx === route.id_str">Gerando arquivo...</span>
          </button>
        </div>

        <div class="route-map" *ngIf="route.map_urls?.url">
          <img [src]="route.map_urls.url" alt="Mapa da rota" />
        </div>
        <a
          class="strava-link"
          [href]="'https://www.strava.com/routes/' + route.id_str"
          target="_blank"
          rel="noopener"
        >
          Ver no Strava
        </a>

        <br>
      </div>
      <!-- Paginação -->
        <mat-paginator class="paginator-container"
          *ngIf="totalPages > 1"
          [length]="filteredRoutes.length"
          [pageSize]="pageSize"
          [pageIndex]="currentPage - 1"
          (page)="onPageChange($event)">
        </mat-paginator>      
      </div>
      <div *ngIf="paginatedRoutes && paginatedRoutes.length === 0" class="no-results">
        Nenhum resultado encontrado.
      </div>
  </ng-container>
</div>